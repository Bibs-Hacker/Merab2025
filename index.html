<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy's KCSE 2025 Encouragement System</title>
    
    <style>
        /* ====================================
           CSS STYLING (Internal)
           ==================================== */
        /* General Styling & Splash Screen */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
            background-color: #1a1a2e; /* Dark background */
            color: white;
            overflow-x: hidden;
        }

        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0d0d1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease-out; /* Fade out effect */
        }

        #logo {
            width: 150px; 
            height: 150px;
            border-radius: 50%;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite alternate;
            background-color: #ff007f; /* Placeholder color if no image is present */
            object-fit: cover; /* Ensure image covers the area nicely */
        }

        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 0 10px #ff007f; }
            to { transform: scale(1.05); box-shadow: 0 0 20px #ff007f, 0 0 30px #00ffff; }
        }

        .hidden {
            display: none !important;
        }

        /* --- Main Content & Background Animation --- */
        #main-content {
            position: relative;
            text-align: center;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            z-index: 10; /* Keep content above background */
        }

        /* Constant Changing Gradient Background */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff007f, #00ffff, #ffcc00, #ff007f, #9900ff, #00ff99); /* More colors */
            background-size: 600% 600%; /* Larger size for smoother transition */
            animation: colorShift 20s ease infinite alternate; /* Slower, smoother shift */
            opacity: 0.4; /* Subtle glow */
            z-index: 1;
        }

        @keyframes colorShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 50% 0%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 100%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Note: For real confetti, you'd need multiple divs/elements */
        /* This is a simple visual to indicate movement */
        .confetti-piece {
            position: absolute;
            background-color: var(--color);
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            opacity: 0;
            animation: fall var(--duration) linear infinite var(--delay);
            z-index: 2; /* Above gradient, below content */
        }

        @keyframes fall {
            0% { transform: translate(var(--startX), var(--startY)) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--endX), var(--endY)) rotate(720deg); opacity: 0; }
        }

        /* --- Buttons --- */
        button {
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 50px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            background: linear-gradient(45deg, #ff007f, #ffcc00);
            color: #1a1a2e;
            box-shadow: 0 4px 15px rgba(255, 0, 127, 0.5);
            z-index: 10;
            position: relative;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 0, 127, 0.8);
        }

        /* --- Modal Styling --- */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2b2b40;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.5s ease-out;
            text-align: left;
            border: 3px solid #ffcc00;
            position: relative; /* For close button positioning */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            position: absolute; /* Position relative to modal-content */
            top: 15px;
            right: 20px;
            z-index: 2001; /* Ensure it's above other content */
        }
        
        .close-btn:hover, .close-btn:focus {
            color: white;
            text-decoration: none;
        }
        
        #inspirational-message p {
            line-height: 1.6;
            margin: 15px 0;
        }
        
        /* --- Gift Card Generator Styling --- */
        #gift-card-generator {
            margin-top: 40px;
            padding: 20px;
            background-color: #2b2b40;
            border-radius: 10px;
            text-align: left;
            z-index: 10;
            position: relative;
        }

        .card-inputs label, .card-inputs input {
            display: block;
            width: 100%;
            margin-top: 10px;
        }

        .card-inputs input {
            padding: 10px;
            border: 2px solid #ffcc00;
            border-radius: 5px;
            background-color: #3b3b50;
            color: white;
            margin-bottom: 15px;
        }

        /* Card Preview Styling (Inbuilt Real-Pictured Card Look) */
        #card-preview {
            margin-top: 20px;
            background: url('hero_background.jpg') no-repeat center center/cover; 
            border: 5px solid gold;
            border-radius: 10px;
            padding: 20px;
            min-height: 250px;
            position: relative;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            overflow: hidden;
            text-shadow: 1px 1px 3px black;
            color: white; /* Ensure text is visible */
        }

        .card-content {
            z-index: 2;
            position: relative;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent overlay for text readability */
            padding: 15px;
            border-radius: 8px;
        }

        .card-profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #ff007f;
            float: right;
            margin-left: 15px;
            margin-bottom: 10px;
        }

        .card-title {
            color: #ffcc00;
            font-size: 1.5em;
        }

        .card-name {
            font-size: 2em;
            margin: 5px 0;
            color: white;
        }

        .card-message {
            font-style: italic;
            margin-top: 10px;
            color: #fff;
            clear: both; /* Ensure message clears floated image */
        }

        .card-actions {
            margin-top: 20px;
            text-align: center;
        }

        .card-actions button {
            background: linear-gradient(45deg, #00c6ff, #0072ff); /* Different gradient for actions */
            color: white;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.5);
        }
        .card-actions button:hover {
            box-shadow: 0 6px 20px rgba(0, 198, 255, 0.8);
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="logo.png" alt="System Logo" id="logo"> 
        <h1>Loading Encouragement...</h1>
    </div>

    <main id="main-content" class="hidden">
        <div class="background-animation"></div> 
        <header>
            <h1>üåü Welcome, KCSE Superstar Mercy! üåü</h1>
            <p>Your journey has been incredible. Let's conquer this final step!</p>
        </header>

        <button id="open-message-btn">‚ú® Tap for a Special Message ‚ú®</button>

        <button id="open-card-btn">üéÅ Generate Your Hero Card üéÅ</button>

        <div id="message-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn" id="close-message-modal">&times;</span>
                <h2>A Message from Your Biggest Fan! ‚ù§Ô∏è</h2>
                <div id="inspirational-message">
                    </div>
            </div>
        </div>

        <section id="gift-card-generator" class="hidden">
            <span class="close-btn" id="close-card-generator">&times;</span>
            <h2>üèÜ KCSE Hero Card Generator üèÜ</h2>
            <p>Celebrate your strength and inspire your classmates!</p>

            <div class="card-inputs">
                <label for="candidate-name">Full Name:</label>
                <input type="text" id="candidate-name" value="Mercy Merab" required>

                <label for="candidate-stream">Stream (e.g., Form 4 Red):</label>
                <input type="text" id="candidate-stream" value="Form 4 Red" required>
                
                <label for="profile-pic-url">Profile Pic URL (Optional):</label>
                <input type="url" id="profile-pic-url" placeholder="Paste image URL here">
                
                <label for="profile-pic-upload">Or Upload Profile Pic:</label>
                <input type="file" id="profile-pic-upload" accept="image/*">

            </div>

            <button id="generate-card-btn">üñºÔ∏è Generate/Update Card Preview</button>

            <h3>Live Preview:</h3>
            <div id="card-preview" class="kcse-card">
                </div>

            <div class="card-actions hidden" id="card-action-buttons">
                <button id="download-card-btn">‚¨áÔ∏è Download Card as Image</button>
            </div>
        </section>

    </main>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        /* ====================================
           JAVASCRIPT LOGIC (Internal)
           ==================================== */
        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const openMessageBtn = document.getElementById('open-message-btn');
            const openCardBtn = document.getElementById('open-card-btn');
            const messageModal = document.getElementById('message-modal');
            const closeMessageModalBtn = document.getElementById('close-message-modal');
            const inspirationalMessageDiv = document.getElementById('inspirational-message');
            const giftCardGenerator = document.getElementById('gift-card-generator');
            const closeCardGeneratorBtn = document.getElementById('close-card-generator');
            const generateCardBtn = document.getElementById('generate-card-btn');
            const cardPreview = document.getElementById('card-preview');
            const candidateNameInput = document.getElementById('candidate-name');
            const candidateStreamInput = document.getElementById('candidate-stream');
            const profilePicUrlInput = document.getElementById('profile-pic-url');
            const profilePicUploadInput = document.getElementById('profile-pic-upload');
            const whatsappContactInput = document.getElementById('whatsapp-contact');
            const cardActionButtons = document.getElementById('card-action-buttons');
            const downloadCardBtn = document.getElementById('download-card-btn');
            const shareWhatsappBtn = document.getElementById('share-whatsapp-btn');

            // --- 1. Splash Screen Fade ---
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    addConfetti(); // Start confetti after main content loads
                    generateCard(); // Generate initial card for Mercy
                }, 1000); // Wait for fade transition to finish (1s in CSS)
            }, 3000); // Display splash screen for 3 seconds

            // --- Confetti Animation (JS driven for more pieces) ---
            const confettiColors = ['#ff007f', '#00ffff', '#ffcc00', '#9900ff', '#00ff99'];
            function addConfetti() {
                for (let i = 0; i < 50; i++) { // Generate 50 confetti pieces
                    const piece = document.createElement('div');
                    piece.classList.add('confetti-piece');
                    const size = Math.random() * 8 + 5; // Size between 5px and 13px
                    const color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                    const duration = Math.random() * 5 + 5; // Duration between 5s and 10s
                    const delay = Math.random() * 10; // Delay up to 10s
                    const startX = Math.random() * window.innerWidth;
                    const startY = -Math.random() * window.innerHeight; // Start above viewport
                    const endX = startX + (Math.random() - 0.5) * 400; // Drift left/right
                    const endY = window.innerHeight + Math.random() * window.innerHeight; // Fall past viewport

                    piece.style.setProperty('--size', `${size}px`);
                    piece.style.setProperty('--color', color);
                    piece.style.setProperty('--duration', `${duration}s`);
                    piece.style.setProperty('--delay', `${delay}s`);
                    piece.style.setProperty('--startX', `${startX}px`);
                    piece.style.setProperty('--startY', `${startY}px`);
                    piece.style.setProperty('--endX', `${endX}px`);
                    piece.style.setProperty('--endY', `${endY}px`);

                    mainContent.appendChild(piece);
                }
            }


            // --- 2. Motivational Message Content & Logic ---
            const message = `
                <p>Dear Mercy Merab, ‚ù§Ô∏è</p>
                <p>This is it! The final lap of an incredible journey. You've been a **star** since playground class, through primary school from Grade 1 to 8, and now you're an amazing Form 4 student finalizing your secondary schooling. üéìüåü</p>
                <p>Your **family** is holding you close in their hearts, friends, and relatives are all sending their strongest hopes and prayers. üôè Much is expected from you, yes, but remember that you are **MERCY MERAB**, a girl of incredible **courage** and talent. Take a deep breath and face the KCSE exams with confidence! üí™</p>
                <p>Don't focus on past stumbles or failures‚Äîthey are just lessons learned. Put your **focus** on the papers in front of you, give it your absolute best, and know that everything is going to be **alright**. We believe in you more than words can say. ‚ú®</p>
                <p>Please send my warmest regards to your awesome classmates, the **Hero Team** of the **Form 4 Red** class, including **Joy, Emma, Sharnell, and the whole gang**, together with all the fantastic candidates of **Ahero Girls High School!** Go get 'em, ladies! üíñüìö</p>
                <p>I'm so incredibly proud of you. Finish strong! üöÄ</p>
                <p>With all my love and endless support.</p>
            `;

            inspirationalMessageDiv.innerHTML = message;

            openMessageBtn.addEventListener('click', () => {
                messageModal.classList.remove('hidden');
            });

            closeMessageModalBtn.addEventListener('click', () => {
                messageModal.classList.add('hidden');
            });

            // Close modal if user clicks outside of it
            window.addEventListener('click', (event) => {
                if (event.target === messageModal) {
                    messageModal.classList.add('hidden');
                }
            });

            // --- 3. Gift Card Generator Logic ---

            openCardBtn.addEventListener('click', () => {
                giftCardGenerator.classList.remove('hidden');
                generateCard(); // Ensure card is generated/updated when opening
            });

            closeCardGeneratorBtn.addEventListener('click', () => {
                giftCardGenerator.classList.add('hidden');
            });

            generateCardBtn.addEventListener('click', generateCard);
            
            // Live preview update on input change
            candidateNameInput.addEventListener('input', generateCard);
            candidateStreamInput.addEventListener('input', generateCard);
            profilePicUrlInput.addEventListener('input', generateCard);
            profilePicUploadInput.addEventListener('change', generateCard);

            function generateCard() {
                const name = candidateNameInput.value || 'Candidate Name';
                const stream = candidateStreamInput.value || 'Form 4';
                let profilePic = 'default_profile.png'; // Fallback profile image 
                
                // Prioritize file upload
                if (profilePicUploadInput.files.length > 0) {
                    profilePic = URL.createObjectURL(profilePicUploadInput.files[0]);
                } else if (profilePicUrlInput.value) {
                    // Fallback to URL input
                    profilePic = profilePicUrlInput.value;
                }

                const cardHTML = `
                    <img src="${profilePic}" alt="${name}'s Profile Picture" class="card-profile-pic" onerror="this.onerror=null;this.src='default_profile.png';">
                    <div class="card-content">
                        <p class="card-title">üåü **KCSE HERO: A TRIBUTE TO YOUR JOURNEY** üåü</p>
                        <h3 class="card-name">${name}</h3>
                        <p><strong>Stream:</strong> ${stream} | Ahero Girls High School</p>
                        <p class="card-message">
                            "From your first steps in Playground Unit to the rigorous challenges of Form Four, you have consistently demonstrated incredible **resilience, determination, and brilliance**. This card is a symbol of your journey and an affirmation of the **star** you've always been. Embrace your final exams with the same **courage** and unwavering spirit. We are immensely proud of you and know you'll conquer this too! **Go for greatness!**"
                        </p>
                        <p style="text-align: right; margin-top: 15px; font-size: 0.9em;">**Your Future Awaits! Believe in Yourself!** ‚ú®</p>
                    </div>
                `;
                cardPreview.innerHTML = cardHTML;
                cardActionButtons.classList.remove('hidden'); // Show action buttons after generation
            }

            // --- Download Card Functionality ---
            downloadCardBtn.addEventListener('click', () => {
                // Temporarily hide action buttons so they don't appear on the screenshot
                cardActionButtons.classList.add('hidden'); 
                
                html2canvas(cardPreview, {
                    scale: 2, // Increase scale for better quality
                    useCORS: true, // Needed if your profile pic URLs are from other domains
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `KCSE_Hero_Card_${candidateNameInput.value.replace(/\s/g, '_')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    // Show action buttons again
                    cardActionButtons.classList.remove('hidden'); 
                }).catch(err => {
                    console.error("Error generating card image:", err);
                    alert("Failed to download card. Please try again. Ensure image URLs are valid.");
                    cardActionButtons.classList.remove('hidden'); // Show buttons even on error
                });
            });

            // --- Share on WhatsApp Functionality ---
            shareWhatsappBtn.addEventListener('click', () => {
                const name = candidateNameInput.value || 'our amazing candidate';
                const whatsappNumber = whatsappContactInput.value.trim();
                
                let messageText = `üåü Congratulations, ${name}! üåü
Check out your personalized KCSE Hero Card:

"From your first steps in Playground Unit to the rigorous challenges of Form Four, you have consistently demonstrated incredible resilience, determination, and brilliance. This card is a symbol of your journey and an affirmation of the star you've always been. Embrace your final exams with the same courage and unwavering spirit. We are immensely proud of you and know you'll conquer this too! Go for greatness!"

I've made this special for you! Remember to download the image I just generated and share it! üòä
`;
                // Encode the message for URL
                const encodedMessage = encodeURIComponent(messageText);

                if (whatsappNumber) {
                    // Open WhatsApp chat directly
                    window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
                } else {
                    // Open generic WhatsApp share if no number is provided
                    window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
                    alert("No WhatsApp number provided. Opening general WhatsApp share. You can manually paste the message and attach the downloaded card image.");
                }
            });
        });
    </script>
</body>
</html>
